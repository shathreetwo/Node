3. MongoDB ì—°ê²°, ê²Œì‹œê¸€(Post) ëª¨ë¸ ìƒì„± ë° CRUD API êµ¬í˜„


Atlas ê°€ì… ë° í´ëŸ¬ìŠ¤í„° ìƒì„±

Mongodb pw : z3yCsAe1HhkLDXTK

ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì ì„¤ì •
Database Access -> Add New Database User
Username / Password ì§€ì • (boarduser / boardpass123)
ê¶Œí•œì€ Read and Write to any database 

IP ì£¼ì†Œ í—ˆìš© ì„¤ì •
ALLOW ACCESS FROM ANYWHERE(0.0.0.0/0)

ì—°ê²° URI ë³µì‚¬
í´ëŸ¬ìŠ¤í„° ëŒ€ì‹œë³´ë“œì—ì„œ Connect 
í”„ë¡œì íŠ¸ ìµœìƒìœ„ì— .env íŒŒì¼ ìƒì„±

server.jsì—ì„œ mongooseë¡œ ì—°ê²°

// server.js
require('dotenv').config(); // ê°€ì¥ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ê¸°!
const express = require('express');
const mongoose = require('mongoose');
const postsRouter = require('./routes/posts');

const app = express();
const PORT = process.env.PORT || 3000;

// MongoDB ì—°ê²°
mongoose.connect(process.env.MONGODB_URI, {
  useNewUrlParser: true,
  useUnifiedTopology: true,
})
.then(() => console.log('âœ… MongoDB ì—°ê²° ì„±ê³µ!'))
.catch((err) => console.error('âŒ MongoDB ì—°ê²° ì‹¤íŒ¨:', err));

// ë¯¸ë“¤ì›¨ì–´
app.use(express.json());

// ë¼ìš°í„° ë“±ë¡
app.use('/posts', postsRouter);

// ê¸°ë³¸ ë¼ìš°í„°
app.get('/', (req, res) => {
  res.send('ğŸ“Œ ê²Œì‹œíŒ ì„œë²„ ë©”ì¸ í˜ì´ì§€ì…ë‹ˆë‹¤!');
});

// ì„œë²„ ì‹œì‘
app.listen(PORT, () => {
  console.log(`âœ… ì„œë²„ ì‹¤í–‰ ì¤‘: http://localhost:${PORT}`);
});

ê²Œì‹œê¸€(Post) ëª¨ë¸ ìƒì„± ë° CRUD API êµ¬í˜„
models/Post.js ìƒì„±

// models/Post.js
const mongoose = require('mongoose');

const postSchema = new mongoose.Schema({
  title: { type: String, required: true },
  content: { type: String, required: true },
  author: { type: String, default: 'ìµëª…' },
  createdAt: { type: Date, default: Date.now }
});

module.exports = mongoose.model('Post', postSchema);

routes/posts.js ìˆ˜ì • (CRUD ê¸°ëŠ¥ ì¶”ê°€)

// routes/posts.js
const express = require('express');
const router = express.Router();
const Post = require('../models/Post');

// ğŸ“Œ ê²Œì‹œê¸€ ì‘ì„±
router.post('/', async (req, res) => {
  try {
    const newPost = await Post.create(req.body);
    res.status(201).json(newPost);
  } catch (err) {
    res.status(400).json({ error: 'ê²Œì‹œê¸€ ìƒì„± ì‹¤íŒ¨', details: err.message });
  }
});

// ğŸ“Œ ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ
router.get('/', async (req, res) => {
  const posts = await Post.find().sort({ createdAt: -1 });
  res.json(posts);
});

// ğŸ“Œ ê²Œì‹œê¸€ ë‹¨ê±´ ì¡°íšŒ
router.get('/:id', async (req, res) => {
  const post = await Post.findById(req.params.id);
  if (post) res.json(post);
  else res.status(404).json({ error: 'ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' });
});

// ğŸ“Œ ê²Œì‹œê¸€ ìˆ˜ì •
router.put('/:id', async (req, res) => {
  try {
    const updated = await Post.findByIdAndUpdate(req.params.id, req.body, { new: true });
    res.json(updated);
  } catch (err) {
    res.status(400).json({ error: 'ìˆ˜ì • ì‹¤íŒ¨', details: err.message });
  }
});

// ğŸ“Œ ê²Œì‹œê¸€ ì‚­ì œ
router.delete('/:id', async (req, res) => {
  await Post.findByIdAndDelete(req.params.id);
  res.json({ message: 'ì‚­ì œ ì™„ë£Œ' });
});

module.exports = router;

ì´ì œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³ , Postman ë˜ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ APIë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì–´ìš”:

GET /posts â†’ ê²Œì‹œê¸€ ëª©ë¡

POST /posts â†’ ìƒˆ ê²Œì‹œê¸€ ìƒì„±

GET /posts/:id â†’ ê²Œì‹œê¸€ ìƒì„¸

PUT /posts/:id â†’ ê²Œì‹œê¸€ ìˆ˜ì •

DELETE /posts/:id â†’ ê²Œì‹œê¸€ ì‚­ì œ

Postmanìœ¼ë¡œ í…ŒìŠ¤íŠ¸
ì™¼ìª½ì—ì„œ POST ì„ íƒ URL ì…ë ¥ http://localhost:3000/posts
Headers íƒ­ í´ë¦­ í›„ ì•„ë˜ í•­ëª© ì…ë ¥:
KEY	VALUE
Content-Type	application/json
Body íƒ­ â†’ raw ì„ íƒ â†’ JSON í˜•ì‹ìœ¼ë¡œ ì•„ë˜ ì…ë ¥:
{
  "title": "Postmanìœ¼ë¡œ ì‘ì„±í•œ ê¸€",
  "content": "ì´ê±´ Postmanì„ í†µí•´ ì‘ì„±í•œ ì²« ê²Œì‹œê¸€ì…ë‹ˆë‹¤.",
  "author": "yuuki"
}
ì „ì†¡ ë° ê²°ê³¼ í™•ì¸

-----ì˜¤ë¥˜-----
í•´ê²°. 
routes/posts.js
ë§¨ ì•„ë˜ì— ë‹¤ìŒì„ ê¼­ ì¶”ê°€:
module.exports = router;

í•œ ì¤„ì´ ì—†ìœ¼ë©´ server.jsì—ì„œ require('./routes/posts')ë¥¼ í–ˆì„ ë•Œ undefinedê°€ ë„˜ì–´ì˜¤ê²Œ ë˜ê³ ,
ê·¸ ê²°ê³¼ë¡œ "argument handler must be a function" ì˜¤ë¥˜ê°€ ë°œìƒ