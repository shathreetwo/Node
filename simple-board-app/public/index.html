<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“‹ ê°„ë‹¨ ê²Œì‹œíŒ</title>
    <style>
    body {
      font-family: 'Arial', sans-serif;
      max-width: 800px;
      margin: 30px auto;
      padding: 10px;
    }
    input, textarea {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
      font-size: 1rem;
    }
    button {
      margin: 5px 2px;
      padding: 8px 16px;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
<h1>ğŸ“‹ ê°„ë‹¨ ê²Œì‹œíŒ</h1>

<form id="postForm">
    <input type="text" id="title" placeholder="ì œëª©" required>
    <textarea id="content" placeholder="ë‚´ìš©" rows="4" required></textarea>
    <input type="text" id="author" placeholder="ì‘ì„±ì (ì„ íƒ)">
    <button type="submit">ê²Œì‹œê¸€ ë“±ë¡</button>
</form>

<hr>

<div id="postsContainer">
    <!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— ì¶œë ¥ë©ë‹ˆë‹¤ -->
</div>

<script>
    const postForm = document.getElementById('postForm');
    const postsContainer = document.getElementById('postsContainer');

    postForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const author = document.getElementById('author').value || 'ìµëª…';

      const res = await fetch('/posts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, content, author })
      });

      if (res.ok) {
        alert('âœ… ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        postForm.reset();
        loadPosts();
      } else {
        alert('âŒ ë“±ë¡ ì‹¤íŒ¨');
      }
    });

    async function loadPosts() {
      const res = await fetch('/posts');
      const posts = await res.json();

      postsContainer.innerHTML = posts.map(p => `
        <div style="border:1px solid #ccc; padding:10px; margin:10px 0;">
          <h3>${p.title}</h3>
          <p>${p.content}</p>
          <small>âœï¸ ${p.author} | ğŸ•’ ${new Date(p.createdAt).toLocaleString()}</small><br>
          <button onclick="deletePost('${p._id}')">ğŸ—‘ï¸ ì‚­ì œ</button>
          <button onclick="editPost('${p._id}', '${p.title}', '${p.content}', '${p.author}')">âœï¸ ìˆ˜ì •</button>
        </div>
      `).join('');
    }

    async function deletePost(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      const res = await fetch(`/posts/${id}`, { method: 'DELETE' });
      if (res.ok) {
        alert('ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ');
        loadPosts();
      } else {
        alert('âŒ ì‚­ì œ ì‹¤íŒ¨');
      }
    }

    function editPost(id, title, content, author) {
      const newTitle = prompt('ì œëª© ìˆ˜ì •:', title);
      const newContent = prompt('ë‚´ìš© ìˆ˜ì •:', content);
      const newAuthor = prompt('ì‘ì„±ì ìˆ˜ì •:', author);

      if (!newTitle || !newContent) {
        alert('ì œëª©ê³¼ ë‚´ìš©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
        return;
      }

      fetch(`/posts/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title: newTitle, content: newContent, author: newAuthor || 'ìµëª…' })
      })
      .then(res => {
        if (res.ok) {
          alert('âœï¸ ìˆ˜ì • ì™„ë£Œ');
          loadPosts();
        } else {
          alert('âŒ ìˆ˜ì • ì‹¤íŒ¨');
        }
      });
    }

    // ì²˜ìŒ ì‹¤í–‰ ì‹œ ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
    loadPosts();
  </script>
</body>
</html>
